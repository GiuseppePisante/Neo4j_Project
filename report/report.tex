\documentclass[a4paper,12pt]{article}
\usepackage[english]{babel}
\usepackage{graphicx}
\usepackage{tikz}
\usepackage{wrapfig}
\usepackage{array}
\usepackage{color} 
\usepackage{hyperref}
\usepackage{enumitem}
\usepackage{booktabs}
\usepackage[font=small,labelfont=bf]{caption}
\hypersetup{
    colorlinks,
    citecolor=black,
    filecolor=black,
    linkcolor=black,
    urlcolor=black
}
\usepackage{changepage}
\addto{\captionsenglish}{\renewcommand{\refname}{}}

\begin{document}

\title{%
  Group Project - Neo4j \\
  \large of Systems and Methods for Big
    and Unstructured Data Course \\(SMBUD)\\
    held by\\ Brambilla Marco\\ Tocchetti Andrea \\
  \vspace{5mm}
  \Large \textbf{Group 78}}
\author{Pisante Giuseppe\\
  \texttt{10696936}
  \and
  Raffaelli Martina\\
  \texttt{10709893}
}
\date{Academic year 2024/2025}
\maketitle
\begin{center}
  \includegraphics[width=4cm]{polilogo.png}\\
\end{center}
\newpage
\tableofcontents
\newpage
\section{Introduction}
\paragraph{} The project aims to design and implement a database system to support the management of data related to the film industry. The database will include entities such as Person (actor, director, writer), Title (film, TV series), Episode, ratings, and genre. The goal is to create a comprehensive system that can store and query information about films, TV series, and the people involved in their production.
The project will develop with Neo4j, to exploit the relations between the entities and find significant insights from the data, such as collaborations between directors and actors, trend of genres over time, most working actors and the most successful films.
\section{Assumptions}
\paragraph{} The project is based on the following assumptions:
\begin{itemize}[noitemsep]
   \item[-] Each person has a unique ID and a name, surname, and date of birth. Some could also have a death date, if passed away.
   \item[-] Each person can be associated with multiple roles (actor, director, writer, archive footage, music department, producer)
   \item[-] Each title has a unique identifier and a title type (film, TV series, shortfilm)
   \item[-] Each title can have multiple episodes
   \item[-] Each title can have multiple genres
   \item[-] Each user can rate a title if and only if it has watched the film
   \item[-] Each title has a unique rating, average rating from the users, and the number of votes
   \item[-] Each person can be associated with multiple titles
   \item[-] Each title can have multiple people associated with it
\end{itemize}
\clearpage
\section{ER diagram}
\paragraph{}
	\begin{center}
 		\includegraphics[width = 15 cm]{polilogo.png}
		\captionof{figure}{E-R Diagram}
	\end{center}
  \subsection{Entities}
\par Starting from the considerations previously exposed regarding the implementation hypotheses, we have drawn an ER diagram (\textbf{Figure 1}) which includes 5 different entities and 7 many-to-many relationships described below in the logical model: \par
  \begin{itemize}[noitemsep]
  \item[-]	\textbf{Person}(\underline{nconst}, PrimaryName, BirthYear, DeathYear, PrimaryProfession, KnownForTitles)
	\item[-]	\textbf{Title}(\underline{tconst}, PrimaryTitle, OriginalTitle, TitleType, StartYear, EndYear, RuntimeMinutes, Genres)
	\item[-]	\textbf{Episode}(\underline{tconst}, ParentTconst, SeasonNumber, EpisodeNumber)
	\item[-]	\textbf{Ratings}(\underline{tconst}, AverageRating, NumVotes)
	\item[-]	\textbf{Genre}(Name)
  \end{itemize} \par
The \textbf{Person} entity describes every possible individual with their own personal data, including their primary profession and titles they are known for. 
The \textbf{Title} entity represents films, TV series or short films with their respective attributes. 
The \textbf{Episode} entity is used to detail episodes of TV series, linked to their parent series. 
The \textbf{Ratings} entity captures the average rating and number of votes for each title. 
Finally, the \textbf{Genre} entity categorizes the titles into different genres.

\subsection{Relationships}
\begin{itemize}[noitemsep]
  
    \item[\textbf{ACTED\_IN}] $(Person)-[:ACTED\_IN]->(Title)$
    
    Relationship between a Person, whose primary profession is actor, and a Title.
    \item[\textbf{DIRECTED}] $(Person)-[:DIRECTED]->(Title)$
    
    Relationship between a Person, whose primary profession is director, and a Title.
    \item[\textbf{WROTE}] $(Person)-[:WROTE]->(Title)$
    
    Relationship between a Person, whose primary profession is writer, and a Title.
    \item[\textbf{PART\_OF}] $(Episode)-[:PART\_OF]->(Title)$
    
    Relationship between an Episode and its parent Title, whose TitleType is TV series.
    \item[\textbf{HAS\_GENRE}] $(Title)-[:HAS\_GENRE]->(Genre)$
    
    Relationship between a Title and a Genre.
    \item[\textbf{HAS\_RATING}] $(Title)-[:HAS\_RATING]->(Rating)$
    
    Relationship between a Title and its Rating.

    
\end{itemize}


\subsection{Constraints:}
Ciao
\section{Cypher Queries}
\subsection{Market Analysis for Marketing Department}
This section of the Cypher Queries aims at providing the Marketing department with insights on the share within the market by providing the number of orders in the Countries in which the Company operates.
In particular, this is done by providing an overview on the total orders per country, the revenue per country, a demographic overview per country and an analysis of the most present brands within a specific 
category, which in this study was chosen as the category with the most orders for further relevance.
\subsubsection{Total orders by Country}
\begin{verbatim}
  MATCH (u:User)-[:PLACES]->(o:Order)
  RETURN u.country AS country, COUNT(o) AS total_orders
  ORDER BY total_orders DESC;
\end{verbatim}
\begin{table}[h!]
  \centering
  \caption{Total Orders by Country}
  \label{tab:total_orders}
  \begin{tabular}{l r}
      \toprule
      \textbf{Country} & \textbf{Total Orders} \\
      \midrule
      China           & 42,986 \\
      United States   & 28,099 \\
      Brasil          & 18,262 \\
      South Korea     & 6,620  \\
      France          & 5,968  \\
      United Kingdom  & 5,673  \\
      Germany         & 5,286  \\
      Spain           & 4,965  \\
      Japan           & 2,945  \\
      Australia       & 2,630  \\
      Belgium         & 1,441  \\
      Poland          & 325    \\
      Colombia        & 19     \\
      Espa単a          & 4      \\
      Austria         & 2      \\
      Deutschland     & 1      \\
      \bottomrule
  \end{tabular}
\end{table}

\subsubsection{Revenue per Country}
\begin{verbatim}
  MATCH (u:User)-[:PLACES]->(o:Order)-[:CONTAINS]->(oi:OrderItem)
  MATCH (oi)-[:REFERS_TO]->(p:Product)
  RETURN u.country AS country, SUM(p.cost) AS total_revenue
  ORDER BY total_revenue DESC;
\end{verbatim}
\begin{table}[h!]
  \centering
  \caption{Total Revenue by Country}
  \label{tab:total_revenue}
  \begin{tabular}{l r}
      \toprule
      \textbf{Country} & \textbf{Total Revenue} \\
      \midrule
      China           & 1,800,865.85 \\
      United States   & 1,162,263.11 \\
      Brasil          & 747,519.90 \\
      South Korea     & 278,958.29 \\
      France          & 243,130.02 \\
      United Kingdom  & 242,263.07 \\
      Germany         & 217,875.61 \\
      Spain           & 210,278.08 \\
      Japan           & 124,807.02 \\
      Australia       & 106,009.74 \\
      Belgium         & 60,226.06 \\
      Poland          & 13,386.90 \\
      Colombia        & 572.51 \\
      Espa単a          & 91.87 \\
      Deutschland     & 65.70 \\
      Austria         & 41.51 \\
      \bottomrule
  \end{tabular}
\end{table}

\subsubsection{Demographic Overview}
\begin{verbatim}
  MATCH (u:User)
  RETURN u.country AS country, 
       COUNT(u) AS total_users,
       AVG(u.age) AS average_age
  ORDER BY total_users DESC;
\end{verbatim}
\begin{table}[h!]
  \centering
  \caption{Total Users and Average Age by Country}
  \label{tab:Average_age}
  \begin{tabular}{l r r}
      \toprule
      \textbf{Country} & \textbf{Total Orders} & \textbf{Average Value} \\
      \midrule
      China           & 34,150  & 40.89 \\
      United States   & 22,522  & 41.21 \\
      Brasil          & 14,507  & 41.19 \\
      South Korea     & 5,316   & 41.25 \\
      France          & 4,700   & 41.57 \\
      United Kingdom  & 4,561   & 41.05 \\
      Germany         & 4,155   & 40.86 \\
      Spain           & 4,062   & 41.01 \\
      Japan           & 2,438   & 40.89 \\
      Australia       & 2,146   & 40.98 \\
      Belgium         & 1,185   & 39.54 \\
      Poland          & 235     & 42.43 \\
      Colombia        & 17      & 34.88 \\
      Deutschland     & 2       & 40.50 \\
      Espa単a          & 2       & 38.50 \\
      Austria         & 2       & 50.00 \\
      \bottomrule
  \end{tabular}
\end{table}

  \subsubsection{Categories with the most orders}
  \begin{verbatim}  
    MATCH (oi:OrderItem)-[:REFERS_TO]->(p:Product)
    RETURN p.product_category AS category, COUNT(oi) AS total_orders
    ORDER BY total_orders DESC
    LIMIT 3;
  \end{verbatim}
  \begin{table}[h!]
    \centering
    \caption{Categories with the most orders}
    \label{tab:total_orders_category}
    \begin{tabular}{l r}
        \toprule
        \textbf{Category} & \textbf{Total Orders} \\
        \midrule
        Intimates     & 13,474 \\
        Jeans         & 12,698 \\
        Tops \& Tees  & 11,925 \\
        \bottomrule
    \end{tabular}
\end{table}

   \subsubsection{Most present brands within the intimates category}
   \begin{verbatim}
    MATCH (oi:OrderItem)-[:REFERS_TO]->(p:Product)
    WHERE p.category = "Intimates"

    RETURN p.brand AS brand, 
          COUNT(oi) AS total_sales
    ORDER BY total_sales DESC
    LIMIT 5;
    \end{verbatim}

    \begin{table}[h!]
      \centering
      \caption{Most present brands within the intimates categor}
      \label{tab:total_sales}
      \begin{tabular}{l r}
          \toprule
          \textbf{Brand}     & \textbf{Total Sales} \\
          \midrule
          Bali           & 405 \\
          Maidenform    & 383 \\
          Hanes         & 364 \\
          Laura         & 342 \\
          Vanity Fair   & 306 \\
          \bottomrule
      \end{tabular}
  \end{table}

  \subsubsection{Most present brands within the intimates category per country}
  \begin{verbatim}
    MATCH (u:User)-[:ORDERED]->(oi:OrderItem)-[:REFERS_TO]->(p:Product)
    WHERE p.category = "Intimates"
    WITH u.country AS country, 
        p.brand AS brand, 
        COUNT(oi) AS total_sales
    ORDER BY country, total_sales DESC
    WITH country, COLLECT({brand: brand, total_sales: total_sales}) AS brand_sales
    RETURN country, 
          brand_sales[0].brand AS top_brand, 
          brand_sales[0].total_sales AS top_sales
    ORDER BY country;
    \end{verbatim}
    \begin{table}[h!]
      \centering
      \caption{Total Orders and Average Value by Country}
      \label{tab:orders_and_average}
      \begin{tabular}{l r r}
          \toprule
          \textbf{Country} & \textbf{Total Orders} & \textbf{Average Value} \\
          \midrule
          China           & 34,150  & 40.89 \\
          United States   & 22,522  & 41.21 \\
          Brasil          & 14,507  & 41.19 \\
          South Korea     & 5,316   & 41.25 \\
          France          & 4,700   & 41.57 \\
          United Kingdom  & 4,561   & 41.05 \\
          Germany         & 4,155   & 40.86 \\
          Spain           & 4,062   & 41.01 \\
          Japan           & 2,438   & 40.89 \\
          Australia       & 2,146   & 40.98 \\
          Belgium         & 1,185   & 39.54 \\
          Poland          & 235     & 42.43 \\
          Colombia        & 17      & 34.88 \\
          Deutschland     & 2       & 40.50 \\
          Espa単a          & 2       & 38.50 \\
          Austria         & 2       & 50.00 \\
          \bottomrule
      \end{tabular}
  \end{table}
\subsection{Logistic Analysis for Logistics Department}
This section of the Cypher Queries aims at providing the Logistics department with insights on the real-time tracking of the orders and all the possible information related to tuser in order to make the delivery as smooth as possible.
In particular, this is done by evaluating the closest distribution center for a specific user, the status of the order, the update of the history of the orders of user and to check if the user has some order pending, in which case the items can be sent together. 

\newpage
\section{References \& Sources}
  \begin{thebibliography}{9}
    \bibitem{} Course Slides
    \bibitem{} https://pysimplegui.readthedocs.io/en/latest/call%20reference/
    \bibitem{} https://py2neo.org/
    \bibitem{} https://neo4j.com/docs/cypher-manual/current/
    \bibitem{} https://neo4j.com/developer/python/
    \bibitem{} http://iniball.altervista.org/Software/ProgER
    \bibitem{} https://neo4j.com/developer/cypher/
    \bibitem{} https://pandas.pydata.org/docs/
  \end{thebibliography}
\end{document}