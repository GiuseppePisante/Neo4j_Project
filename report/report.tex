\documentclass[a4paper,12pt]{article}
\usepackage[english]{babel}
\usepackage{graphicx}
\usepackage{tikz}
\usepackage{wrapfig}
\usepackage{array}
\usepackage{color} 
\usepackage{hyperref}
\usepackage{enumitem}
\usepackage{booktabs}
\usepackage[font=small,labelfont=bf]{caption}
\hypersetup{
    colorlinks,
    citecolor=black,
    filecolor=black,
    linkcolor=black,
    urlcolor=black
}
\usepackage{changepage}
\addto{\captionsenglish}{\renewcommand{\refname}{}}

\begin{document}

\title{%
  Group Project - Neo4j \\
  \large of Systems and Methods for Big
    and Unstructured Data Course \\(SMBUD)\\
    held by\\ Brambilla Marco\\ Tocchetti Andrea \\
  \vspace{5mm}
  \Large \textbf{Group 78}}
\author{Pisante Giuseppe\\
  \texttt{10696936}
  \and
  Raffaelli Martina\\
  \texttt{10709893}
}
\date{Academic year 2024/2025}
\maketitle
\begin{center}
  \includegraphics[width=4cm]{polilogo.png}\\
\end{center}
\newpage
\tableofcontents
\newpage
\section{Introduction}
\paragraph{} The project aims to design and implement a database system to manage and analyze data related to an e-commerce platform. The database will include entities such as Customer, Product, Order, Category, and Payment. The goal is to create an efficient system that can store and query information about customer purchases, product details, and transactions, providing valuable insights into user behavior, sales trends, and inventory management.
\\
The project will be developed using a relational database management system (RDBMS), which will facilitate structured querying of data to support key functions like product recommendations, customer segmentation, sales analysis, and inventory forecasting. The system will allow for tracking of customer purchase history, order details, product categories, payment methods, and discounts, helping businesses optimize their operations and enhance the customer experience.
\section{Assumptions}
\paragraph{} The project is based on the following assumptions:
\begin{itemize}[noitemsep]
   \item[-] Each customer has a unique ID, name, surname, email address, and date of birth.
   \item[-] Each product has a unique identifier, name, description, price, and category.
   \item[-] Each product can be associated with multiple categories.
   \item[-] Each customer can place multiple orders.
   \item[-] Each order can contain multiple products.
   \item[-] Each order has a unique ID, order date, total amount, and payment method.
   \item[-] Each product can have multiple variants (e.g., size, color).
   \item[-] Each product can have multiple reviews, where each review includes a rating and comments from a customer.
   \item[-] Each payment is associated with a unique transaction ID, payment method, and amount.
   \item[-] Each customer can leave a review for a product if and only if they have purchased it.
\end{itemize}

\clearpage
\section{ER diagram}
\paragraph{}
	\begin{center}
 		\includegraphics[width = 15 cm]{polilogo.png}
		\captionof{figure}{E-R Diagram}
	\end{center}
  \subsection{Entities}
  \par Starting from the considerations previously exposed regarding the implementation hypotheses, we have drawn an ER diagram (\textbf{Figure 1}) which includes 5 different entities and 7 many-to-many relationships described below in the logical model: \par
    \begin{itemize}[noitemsep]
    \item[-]	\textbf{Customer}(\underline{customer\_id}, Name, Surname, Email, BirthDate, Address, PhoneNumber)
    \item[-]	\textbf{Product}(\underline{product\_id}, ProductName, Description, Price, Stock, Category)
    \item[-]	\textbf{Order}(\underline{order\_id}, CustomerID, OrderDate, TotalAmount, PaymentMethod, ShippingAddress)
    \item[-]	\textbf{Order\_Item}(\underline{order\_id}, \underline{product\_id}, Quantity, UnitPrice)
    \item[-]	\textbf{Review}(\underline{review\_id}, CustomerID, ProductID, Rating, Comment, ReviewDate)
    \item[-]	\textbf{Category}(\underline{category\_id}, CategoryName)
    \item[-]	\textbf{Payment}(\underline{payment\_id}, OrderID, PaymentDate, PaymentAmount, PaymentMethod)
    \end{itemize} \par
  The \textbf{Customer} entity represents the individuals who make purchases on the platform, storing essential information such as their personal details and contact information. 
  The \textbf{Product} entity represents the items available for sale, including product details such as name, description, price, stock level, and category. 
  The \textbf{Order} entity captures information related to a customer’s order, such as the order date, total amount, payment method, and shipping address.
  The \textbf{Order\_Item} entity links products to specific orders, detailing the quantity of each product ordered and its unit price.
  The \textbf{Review} entity stores customer feedback for purchased products, including ratings and comments, along with the review date.
  The \textbf{Category} entity defines the product categories, allowing for classification of products into different types.
  Finally, the \textbf{Payment} entity records the payment details for each order, including the payment method and the amount paid.
  
\subsection{Relationships}
\begin{itemize}[noitemsep]
  
    \item[\textbf{ACTED\_IN}] $(Person)-[:ACTED\_IN]->(Title)$
    
    Relationship between a Person, whose primary profession is actor, and a Title.
    \item[\textbf{DIRECTED}] $(Person)-[:DIRECTED]->(Title)$
    
    Relationship between a Person, whose primary profession is director, and a Title.
    \item[\textbf{WROTE}] $(Person)-[:WROTE]->(Title)$
    
    Relationship between a Person, whose primary profession is writer, and a Title.
    \item[\textbf{PART\_OF}] $(Episode)-[:PART\_OF]->(Title)$
    
    Relationship between an Episode and its parent Title, whose TitleType is TV series.
    \item[\textbf{HAS\_GENRE}] $(Title)-[:HAS\_GENRE]->(Genre)$
    
    Relationship between a Title and a Genre.
    \item[\textbf{HAS\_RATING}] $(Title)-[:HAS\_RATING]->(Rating)$
    
    Relationship between a Title and its Rating.

    
\end{itemize}


\subsection{Constraints:}
Ciao
\section{Cypher Queries}
\subsection{Market Analysis for Marketing Department}
This section of the Cypher Queries aims at providing the Marketing department with insights on the share within the market by providing the number of orders in the Countries in which the Company operates.
In particular, this is done by providing an overview on the total orders per country, the revenue per country, a demographic overview per country and an analysis of the most present brands within a specific 
category, which in this study was chosen as the category with the most orders for further relevance.
\subsubsection{Total orders by Country}
\begin{verbatim}
  MATCH (u:User)-[:PLACES]->(o:Order)
  RETURN u.country AS country, COUNT(o) AS total_orders
  ORDER BY total_orders DESC;
\end{verbatim}
\begin{table}[h!]
  \centering
  \caption{Total Orders by Country}
  \label{tab:total_orders}
  \begin{tabular}{l r}
      \toprule
      \textbf{Country} & \textbf{Total Orders} \\
      \midrule
      China           & 42,986 \\
      United States   & 28,099 \\
      Brasil          & 18,262 \\
      South Korea     & 6,620  \\
      France          & 5,968  \\
      United Kingdom  & 5,673  \\
      Germany         & 5,286  \\
      Spain           & 4,965  \\
      Japan           & 2,945  \\
      Australia       & 2,630  \\
      Belgium         & 1,441  \\
      Poland          & 325    \\
      Colombia        & 19     \\
      España          & 4      \\
      Austria         & 2      \\
      Deutschland     & 1      \\
      \bottomrule
  \end{tabular}
\end{table}

\subsubsection{Revenue per Country}
\begin{verbatim}
  MATCH (u:User)-[:PLACES]->(o:Order)-[:CONTAINS]->(oi:OrderItem)
  MATCH (oi)-[:REFERS_TO]->(p:Product)
  RETURN u.country AS country, SUM(p.cost) AS total_revenue
  ORDER BY total_revenue DESC;
\end{verbatim}
\begin{table}[h!]
  \centering
  \caption{Total Revenue by Country}
  \label{tab:total_revenue}
  \begin{tabular}{l r}
      \toprule
      \textbf{Country} & \textbf{Total Revenue} \\
      \midrule
      China           & 1,800,865.85 \\
      United States   & 1,162,263.11 \\
      Brasil          & 747,519.90 \\
      South Korea     & 278,958.29 \\
      France          & 243,130.02 \\
      United Kingdom  & 242,263.07 \\
      Germany         & 217,875.61 \\
      Spain           & 210,278.08 \\
      Japan           & 124,807.02 \\
      Australia       & 106,009.74 \\
      Belgium         & 60,226.06 \\
      Poland          & 13,386.90 \\
      Colombia        & 572.51 \\
      España          & 91.87 \\
      Deutschland     & 65.70 \\
      Austria         & 41.51 \\
      \bottomrule
  \end{tabular}
\end{table}

\subsubsection{Demographic Overview}
\begin{verbatim}
  MATCH (u:User)
  RETURN u.country AS country, 
       COUNT(u) AS total_users,
       AVG(u.age) AS average_age
  ORDER BY total_users DESC;
\end{verbatim}
\begin{table}[h!]
  \centering
  \caption{Total Users and Average Age by Country}
  \label{tab:Average_age}
  \begin{tabular}{l r r}
      \toprule
      \textbf{Country} & \textbf{Total Orders} & \textbf{Average Value} \\
      \midrule
      China           & 34,150  & 40.89 \\
      United States   & 22,522  & 41.21 \\
      Brasil          & 14,507  & 41.19 \\
      South Korea     & 5,316   & 41.25 \\
      France          & 4,700   & 41.57 \\
      United Kingdom  & 4,561   & 41.05 \\
      Germany         & 4,155   & 40.86 \\
      Spain           & 4,062   & 41.01 \\
      Japan           & 2,438   & 40.89 \\
      Australia       & 2,146   & 40.98 \\
      Belgium         & 1,185   & 39.54 \\
      Poland          & 235     & 42.43 \\
      Colombia        & 17      & 34.88 \\
      Deutschland     & 2       & 40.50 \\
      España          & 2       & 38.50 \\
      Austria         & 2       & 50.00 \\
      \bottomrule
  \end{tabular}
\end{table}

  \subsubsection{Categories with the most orders}
  \begin{verbatim}  
    MATCH (oi:OrderItem)-[:REFERS_TO]->(p:Product)
    RETURN p.product_category AS category, COUNT(oi) AS total_orders
    ORDER BY total_orders DESC
    LIMIT 3;
  \end{verbatim}
  \begin{table}[h!]
    \centering
    \caption{Categories with the most orders}
    \label{tab:total_orders_category}
    \begin{tabular}{l r}
        \toprule
        \textbf{Category} & \textbf{Total Orders} \\
        \midrule
        Intimates     & 13,474 \\
        Jeans         & 12,698 \\
        Tops \& Tees  & 11,925 \\
        \bottomrule
    \end{tabular}
\end{table}

   \subsubsection{Most present brands within the intimates category}
   \begin{verbatim}
    MATCH (oi:OrderItem)-[:REFERS_TO]->(p:Product)
    WHERE p.category = "Intimates"

    RETURN p.brand AS brand, 
          COUNT(oi) AS total_sales
    ORDER BY total_sales DESC
    LIMIT 5;
    \end{verbatim}

    \begin{table}[h!]
      \centering
      \caption{Most present brands within the intimates categor}
      \label{tab:total_sales}
      \begin{tabular}{l r}
          \toprule
          \textbf{Brand}     & \textbf{Total Sales} \\
          \midrule
          Bali           & 405 \\
          Maidenform    & 383 \\
          Hanes         & 364 \\
          Laura         & 342 \\
          Vanity Fair   & 306 \\
          \bottomrule
      \end{tabular}
  \end{table}

  \subsubsection{Most present brands within the intimates category per country}
  \begin{verbatim}
    MATCH (u:User)-[:ORDERED]->(oi:OrderItem)-[:REFERS_TO]->(p:Product)
    WHERE p.category = "Intimates"
    WITH u.country AS country, 
        p.brand AS brand, 
        COUNT(oi) AS total_sales
    ORDER BY country, total_sales DESC
    WITH country, COLLECT({brand: brand, total_sales: total_sales}) AS brand_sales
    RETURN country, 
          brand_sales[0].brand AS top_brand, 
          brand_sales[0].total_sales AS top_sales
    ORDER BY country;
    \end{verbatim}
    \begin{table}[h!]
      \centering
      \caption{Total Orders and Average Value by Country}
      \label{tab:orders_and_average}
      \begin{tabular}{l r r}
          \toprule
          \textbf{Country} & \textbf{Total Orders} & \textbf{Average Value} \\
          \midrule
          China           & 34,150  & 40.89 \\
          United States   & 22,522  & 41.21 \\
          Brasil          & 14,507  & 41.19 \\
          South Korea     & 5,316   & 41.25 \\
          France          & 4,700   & 41.57 \\
          United Kingdom  & 4,561   & 41.05 \\
          Germany         & 4,155   & 40.86 \\
          Spain           & 4,062   & 41.01 \\
          Japan           & 2,438   & 40.89 \\
          Australia       & 2,146   & 40.98 \\
          Belgium         & 1,185   & 39.54 \\
          Poland          & 235     & 42.43 \\
          Colombia        & 17      & 34.88 \\
          Deutschland     & 2       & 40.50 \\
          España          & 2       & 38.50 \\
          Austria         & 2       & 50.00 \\
          \bottomrule
      \end{tabular}
  \end{table}
\subsection{Logistic Analysis for Logistics Department}
This section of the Cypher Queries aims at providing the Logistics department with insights on the real-time tracking of the orders and all the possible information related to tuser in order to make the delivery as smooth as possible.
In particular, this is done by evaluating the closest distribution center for a specific user, the status of the order, the update of the history of the orders of user and to check if the user has some order pending, in which case the items can be sent together. 

\subsubsection{Closest Distribution Center}
\begin{verbatim}
  MATCH (u:User)-[:PERFORM_EVENT]->(h:History)
  WHERE u.id = "100"
  MATCH (d:DistributionCenter)
  WHERE d.latitude IS NOT NULL AND d.longitude IS NOT NULL
  WITH u, d, 
      point({latitude: u.latitude, longitude: u.longitude}) AS user_location, 
      point({latitude: d.latitude, longitude: d.longitude}) AS distribution_center_location
  WITH u, d, user_location, distribution_center_location, 
      point.distance(user_location, distribution_center_location) AS distance
  ORDER BY distance
  LIMIT 1
  RETURN d.name, distance;
\end{verbatim}

\begin{table}[h!]
  \centering
  \caption{Data for Los Angeles CA}
  \label{tab:los_angeles_data}
  \begin{tabular}{l r}
      \toprule
      \textbf{Location} & \textbf{Value} \\
      \midrule
      Los Angeles CA & 10539304.46257035 \\
      \bottomrule
  \end{tabular}
\end{table}

\subsubsection{Order History}
In order to provide our logistic department with the most updated information, we have to provide them with the history of the orders of a specific user.
In particular, we have to fill the history node with the latest information. In order to do that, we first add the new order to order, and then we add the new order to the history of the user.
\begin{verbatim}
  // Add the new order to the order node
    MATCH (u:User)
    WHERE u.id="100"
    WITH u
    MATCH (o:Order)
    WITH u, MAX(o.order_id) AS max_order_id
    CREATE (newOrder:Order { 
        order_id: toString(200000), 
        status: "Processing",
        gender: u.gender,
        created_at: date(),
        returned_at: null,
        shipped_at: null,
        delivered_at: null,
        num_of_item: 3
    })
    MERGE (u)-[:PLACES]->(newOrder);
\end{verbatim}

\subsubsection{Order Status}
\begin{verbatim}
  MATCH (u:User)-[:PLACES]->(o:Order)
  WHERE u.id = "100"
  WITH o ORDER BY o.created_at DESC LIMIT 1
  RETURN o.order_id, o.status AS order_status, o.created_at;
\end{verbatim}
\begin{table}[h!]
  \centering
  \caption{Data for Processing Task}
  \label{tab:processing_data}
  \begin{tabular}{l l l}
      \toprule
      \textbf{ID} & \textbf{Status} & \textbf{Timestamp} \\
      \midrule
      561 & Processing & 2023-12-15 17:28:00+00:00 \\
      \bottomrule
  \end{tabular}
\end{table}

\newpage
\section{References \& Sources}
  \begin{thebibliography}{9}
    \bibitem{} Course Slides
    \bibitem{} https://pysimplegui.readthedocs.io/en/latest/call%20reference/
    \bibitem{} https://py2neo.org/
    \bibitem{} https://neo4j.com/docs/cypher-manual/current/
    \bibitem{} https://neo4j.com/developer/python/
    \bibitem{} http://iniball.altervista.org/Software/ProgER
    \bibitem{} https://neo4j.com/developer/cypher/
    \bibitem{} https://pandas.pydata.org/docs/
  \end{thebibliography}
\end{document}